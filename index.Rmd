---
title: "Stay safe!<br>Mapping the crime events in Buffalo, NY (2010-2020)"
author: "Wei Liu"
subtitle: "Explore the spatiotemporal pattern of crime events in the City of Buffalo, New York, USA"
---

# Introduction

Crime, as what it always appears to be, is the negative power in our society that tends to trigger multiple problems. With the increasing demand for higher quality of life in the modern world, the general public attaches more attention to the safety of the living environment as one of the basic factors considered. There has been considerable effort extended to exploring and understanding the pattern of various types of crimes. There exists a sub-field, namely, geographic profiling, which is the marginal subject of criminology and geography, looking into the crime events with both the theoretical basics from criminology and spatial methodologies from geography, with the ultimate goal of promoting suggestions for reducing crime rates and maintaining social safety.  
  
In this project, we want to reveal and understand the spatiotemporal distribution of crime incidents in Buffalo, New York. We are going to achieve our objective mainly by visualization of the crime incidents over time as well as over the study region. Besides, we also want to detect the relationship between crime and corresponding sociodemographic attributes in each defined area. The contribution of this project can be three-folded:  

&nbsp; &nbsp; &nbsp; &nbsp; Firstly, we analyze the pattern of crime incidents in Buffalo, NY from multiple dimensions through innovative approaches.<br>
&nbsp; &nbsp; &nbsp; &nbsp; Secondly, we further explore the potential mechanism behind the scene which may play a role in the formation of crime incidents.<br>
&nbsp; &nbsp; &nbsp; &nbsp; Thirdly, based on the aforementioned results, we are able to provide useful suggestions for promoting overall social safety.<br>


# Data and methods

## Data

1. Crime incidents

&nbsp; &nbsp; &nbsp; &nbsp; The csv file of crime incidents is in the public domain, available from the website of Open Data Portal of the City of Buffalo.

2. Census Block Groups (CBGs) 2010 of the City of Buffalo

&nbsp; &nbsp; &nbsp; &nbsp; The Census Block Groups 2010 data is available from Buffalo Open Data Portal. CBGs are statistical divisions of census tracts, are generally defined to contain between 600 and 3,000 people, and are used to present data and control block numbering. We perform our explorations at the CBG level in this project.

3. Sociodemographic data

&nbsp; &nbsp; &nbsp; &nbsp; The sociodemographic data comes from the API of tidycensus.

## Methods

The major method utilized in this project is visualization. And the visualization consists of two main parts. Firstly, we create static and dynamic plots to show the changing behaviors of crime incidents from 2010 to 2020. Secondly, we create an interactive map that depicts the spatial distribution of the crime incidents in Buffalo, NY. Finally, using data in the year of 2019 as an example, we reveal the probable relationship between crime incidents and sociodemographic attributes by calculating the correlation coefficients.

# Process

## Load needed packages

```{r, message=FALSE, results='hide'}
# needed packages
library(readr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(chron)
library(lubridate)
library(gganimate)
library(viridis)
library(GISTools)
library(tidycensus)
library(sf)
```

## Data collection and preprocessing

### Crime incidents

Firstly, we download the crime incidents data from Buffalo Open Data Portal.
  
```{r, message=FALSE, warning=FALSE, results='hide'}
crime_original = read_csv("https://data.buffalony.gov/api/views/d6g9-xbgu/rows.csv?accessType=DOWNLOAD")
```

secondly, we preprocess the crime incidents data.
```{r, message=FALSE, results='hide'}
crime_pre <- crime_original %>%
  # For the column of incident_type_primary, change all letters into lower cases (e.g., Assault and ASSAULT are actually the same type of crime.)
  mutate(incident_type_primary = tolower(incident_type_primary)) %>%
  # the column of incident_datetime has 5 NA, so we fill them with the values in the column of create_at respectively.
  mutate(incident_datetime = ifelse(is.na(incident_datetime), created_at, incident_datetime)) %>%
  # change the column of incident_datetime into a standard date-time format.
  mutate(incident_datetime = parse_date_time(incident_datetime, '%m/%d/%Y %I:%M:%S %p')) %>%
  # extract year and hour from the column of incident_datetime
  mutate(incident_year = format(incident_datetime, "%Y")) %>%
  mutate(incident_hour = format(incident_datetime, "%H")) %>%
  # filter by date and time (crimes recorded between 2010 and 2020)
  filter(incident_year >= 2010 & incident_year <= 2020) %>%
  # drop those records that do not contain the coordinate information
  drop_na(latitude)
```

### Census Block Group 2010

We read the file of Census Block Group into the environment.

```{r, message=FALSE, results='hide'}
Buffalo_CBG = st_read("data/buffalo_cbg.shp")
```

### Sociodemographic data

We use the tidycensus API to access U.S. Census data. The variables that we use in this project are population, black population, white population, population aged 65 and over, median household income, and population with Bachelor's degree.

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hold'}
census_api_key("a718a73636c5abd5f89dfb04bad709219e4468d2", install=TRUE, overwrite=TRUE)
```

```{r, message=FALSE, warning=FALSE, results='hide'}
population <- get_acs(geography = "block group", state="NY", county="Erie",
                      variables = "B01003_001",
                      year=2019)
population = rename(population, c("population"= "estimate"))

black <- get_acs(geography = "block group", state="NY", county="Erie", variables = "B02001_003", year=2019)
black = rename(black, c("black"= "estimate"))

white <- get_acs(geography = "block group", state="NY", county="Erie", variables = "B02001_002", year=2019)
white = rename(white, c("white"= "estimate"))

aged <- get_acs(geography = "block group", state="NY", county="Erie", variables = "B29001_005", year=2019)
aged = rename(aged, c("aged"= "estimate"))

income <- get_acs(geography = "block group", state="NY", county="Erie", variables = "B19013_001", year=2019)
income = rename(income, c("income"= "estimate"))

bachelor <- get_acs(geography = "block group", state="NY", county="Erie", variables = "B15012_001", year=2019)
bachelor = rename(bachelor, c("bachelor"= "estimate"))
```
Then, we organize the sociodemographic data together with the CBG data.

```{r}
Buffalo_demo <- Buffalo_CBG %>%
  left_join(population, by = c("geoid10" = "GEOID")) %>%
  left_join(black, by = c("geoid10" = "GEOID")) %>%
  left_join(white, by = c("geoid10" = "GEOID")) %>%
  left_join(aged, by = c("geoid10" = "GEOID")) %>%
  left_join(income, by = c("geoid10" = "GEOID")) %>%
  left_join(bachelor, by = c("geoid10" = "GEOID")) %>%
  select(GEOID, population, black, white, aged, income, bachelor, geometry)
```

 And to remove the effect of population disparity, we normalize some of our variables by population.